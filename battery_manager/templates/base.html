<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Kostal Battery Manager{% endblock %}</title>
    {% block head %}{% endblock %}
    <link rel="stylesheet" href="{{ base_path }}/static/css/style.css?v=0.9.2">
    <link rel="icon" type="image/png" href="{{ base_path }}/static/img/icon.png">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1>üîã Kostal Battery Manager</h1>
            </div>
            <div class="nav-links">
                <a href="{{ base_path }}/" class="nav-link {% if request.path == '/' %}active{% endif %}">üìä Dashboard</a>
                <a href="{{ base_path }}/config" class="nav-link {% if request.path == '/config' %}active{% endif %}">‚öôÔ∏è Konfiguration</a>
                <a href="{{ base_path }}/consumption_import" class="nav-link {% if request.path == '/consumption_import' %}active{% endif %}">üì• Verbrauchsdaten</a>
                <a href="{{ base_path }}/logs" class="nav-link {% if request.path == '/logs' %}active{% endif %}">üìú Logs</a>
            </div>
        </nav>
    </header>

    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <footer>
        <p>Kostal Battery Manager v1.0.3 | Made with ‚ù§Ô∏è for Home Assistant</p>
    </footer>

    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Set BASE_PATH for API calls to work with Ingress -->
    <script>
        window.BASE_PATH = '{{ base_path }}' || '';
        // Helper function to construct API URLs correctly with or without Ingress prefix
        window.apiUrl = function(path) {
            // Remove leading slash from path if present
            const cleanPath = path.startsWith('/') ? path.substring(1) : path;
            // If BASE_PATH is empty, just return the path with leading slash
            if (!window.BASE_PATH || window.BASE_PATH === '') {
                return '/' + cleanPath;
            }
            // Otherwise, combine BASE_PATH with path
            return window.BASE_PATH + '/' + cleanPath;
        };
        console.log('BASE_PATH:', window.BASE_PATH);
        console.log('Test apiUrl("api/status"):', window.apiUrl('api/status'));
    </script>
    <script src="{{ base_path }}/static/js/app.js?v=0.9.2"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
